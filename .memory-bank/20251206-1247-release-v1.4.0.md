# Release: v1.4.0

**Date:** 2025-12-06
**PR:** #49 - feat: streaming responses with cancellation support
**Branch:** `sprint/epic-ahp-v1.3-sub4-03-streaming-cancel`
**Merge Type:** merge commit

---

## Summary

Major feature release adding streaming responses and request cancellation across all AI operations. Users can now watch responses generate in real-time and cancel mid-stream to save tokens.

### Key Features

1. **Streaming Responses** - Real-time AI output for analysis, context, and dictionary
2. **Request Cancellation** - Cancel button with AbortSignal propagation through entire stack
3. **Race Condition Protection** - New requests auto-cancel in-progress ones
4. **Robustness Fixes** - Memory leak fix, HTTP cleanup, debug logging

---

## Files Modified

### Version Bump
- `package.json` (1.3.3 → 1.4.0)
- `src/extension.ts` (version string)
- `CHANGELOG.md`
- `docs/CHANGELOG-DETAILED.md`

### PR Changes (9 commits)
- New streaming infrastructure (useStreaming hook, StreamingContent component)
- Handler streaming lifecycle (AnalysisHandler, ContextHandler, DictionaryHandler)
- AbortSignal threading (OpenRouterClient, services)
- Domain hooks with cancellation (useAnalysis, useContext, useDictionary)
- Message contracts (streaming.ts)

---

## Version Bump

- **Previous:** v1.3.3
- **New:** v1.4.0
- **Type:** MINOR (new features, backward compatible)

---

## Post-Merge Fixes

Additional fixes applied after initial PR review:

1. **Memory Leak Fix** - Clear `ignoredRequestIds` on stream complete
2. **Backend Cancel** - Send cancel message when preempting old streams
3. **OutputChannel Wiring** - Pass through AIResourceManager to OpenRouterClient

---

## Architecture Highlights

**AbortSignal Threading:**
```
UI → useAnalysis.handleCancel()
  → CANCEL_ANALYSIS_REQUEST message
    → AnalysisHandler.handleCancelRequest()
      → abortController.abort()
        → AssistantToolService (catches AbortError)
          → OpenRouterClient (stream.cancel())
```

**Race Condition Protection:**
- New request cancels old via message + ignored set
- Ignored IDs cleaned up on stream complete
- No orphaned requests burning tokens

---

## Next Steps

- [ ] Tag v1.4.0 created
- [ ] GitHub release (pending decision)
- [ ] Marketplace publish (via /release-vsce)
